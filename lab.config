<?php namespace Dotink\Lab {

	return [

		//
		// This defines a relative or absolute path to our tests directory containing our
		// test files
		//

		'tests_directory' => 'test/routines',

		//
		// By default we disable autoloading.  The prevents us from loading and depending on any
		// classes by accident forcing us to purposefully include them or mock them
		//

		'disable_autoloading' => TRUE,

		//
		// The global 'setup' key can contain a closure to run fixture logic at the beginning of
		// every
		//

		'setup' => function($data, $shared) {

			//
			// If you require parody in your project, you can load it by uncommenting here.
			// Note that you may need to tweak the vendor dir.
			//
			//
			// needs($data['root'] . '/vendor/dotink/parody/src/Load.php');
			//

			$shared->timer          = new Utilities\Timer();
			$shared->coverageReport = new Coverage\Report($data['root']);
			$shared->coverageEngine = new Coverage\Engine($shared->coverageReport);

			$shared->coverageEngine->ignoreFile(LAB);
			$shared->coverageEngine->ignoreFile(__FILE__);
			$shared->coverageEngine->ignoreFile($data['test']);

			$shared->coverageEngine->ignoreClass('Composer(.*)');
			$shared->coverageEngine->ignoreFunction('Composer(.*)');
			$shared->coverageEngine->ignoreNamespace('Composer(\(.*))?');

			$shared->coverageEngine->ignoreNamespace('Dotink\Lab(\(.*))?');

			$shared->coverageEngine->start();
			$shared->timer->start();
		},

		//
		// The global 'cleanup' key can contain a closure to run fixture cleanup logic at the end
		// of every test file
		//

		'cleanup' => function($data, $shared) {
			$shared->timer->stop();

			echo LB . 'Time:   ' . $shared->timer->getTime();
			echo LB . 'Memory: ' . number_format(memory_get_usage() / 1024 / 1024, 2) . 'mb';
			echo LB;

			$shared->coverageEngine->stop();
		},

		//
		// Arbitrary values can be specified, all 'setup' and 'cleanup' functions (global) and per
		// test file are given the $data array as a first parameter.
		//

		'data' => [
			'root' => realpath(__DIR__)
		]
	];
}
